---
# Prepare configuration files
- name: Create kubernetes config directory
  file: path={{ manifest_config_dir }} state=directory
  register: manifest

- name: Create weave dir
  when: weave_net
  file: path={{ weavedir }} state=directory

- name: Copy weave file
  when: weave_net
  copy: src=10-weave.conf  dest=/etc/cni/net.d/10-weave.conf

- name: Copy api config file
  template: src="kube-apiserver.json.j2" dest={{ manifest_config_dir }}/kube-apiserver.json
  register: api

- name: Copy controller config file
  template: src="kube-controller-manager.json.j2" dest={{ manifest_config_dir }}/kube-controller-manager.json
  register: controller

- name: Copy scheduler config file
  template: src="kube-scheduler.json.j2" dest={{ manifest_config_dir }}/kube-scheduler.json
  register: scheduler

- name: Copy kube config file
  template: src="kubeadminconfig.j2" dest={{ kube_config_dir }}/kubeadminconfig
  register: config

- name: Copy openssl certificate from ansible host
  copy: src={{ master_cert_dir }} dest={{ kube_config_dir }}
  register: openssl_cert

- name: Copy kubelet-config file
  template: src="kubelet.j2" dest={{ kube_config_dir }}/kubelet
  register: kubelet_conf

- name: Copy kubelet-service file
  copy: src=kubelet.service dest=/etc/systemd/system/kubelet.service owner=root group=root mode=0755
  register: kubelet_service

- name: Create kubelet directory
  file: path=/var/lib/kubelet state=directory

---
- name: Override flannel drop-in directory for Debian
  when: ansible_os_family == "Debian"
  set_fact:
    dropin_dir: "/etc/systemd/system"

- name: Copy flannel default env file
  template: src="flanneld.j2" dest={{ env_config_dir }}/flanneld

- name: Create Docker systemd drop-in directory
  file: path={{ dropin_dir }}/docker.service.d state=directory

- name: Add docker drop-in with dependency on flannel
  copy: src=flannel.conf dest="{{ dropin_dir }}/docker.service.d/flannel.conf"

- name: Add flanneld service file
  template: src=flanneld.service.j2 dest={{ service_dir }}/flanneld.service
  register: change_flannel
